syntax = "proto3";

message PacketHeader {
  uint32 system_uid     = 1;
  uint32 ms_from_start  = 2;
  uint64 epoch          = 3;
  uint32 packet_index   = 4;
}

// ================== SCHEDULING / CONFIG ==================

// 20 to 6 means 8pm to 6am
message TimeWindow {
  uint32 start_hour = 1;  // 0 to 23 (inclusive)
  uint32 end_hour   = 2;  // 0 to 23 (inclusive)
}

// Enabled/disabled and sample interval for each sensor
message SamplingConfig {
  bool   enabled              = 1;
  uint32 sample_interval_min  = 2; // minutes
}

// GPS
message GPSConfig {
  bool   enabled              = 1;
  uint32 sample_interval_min  = 2;
  uint32 accuracy     = 3; // 1 to 10
}

enum RadioRegion {
  REGION_US915 = 0;
  REGION_AU915 = 1;
  REGION_EU868 = 2;
}

enum RadioAuth {
  AUTH_OTAA = 0;
  AUTH_ABP  = 1;
}

message RadioOTAA {
  bytes dev_eui  = 1; // 8 bytes
  bytes join_eui = 2; // 8 bytes
  bytes app_key  = 3; // 16 bytes
}

message RadioABP {
  bytes dev_addr        = 1; // 4 bytes
  bytes nwk_s_key       = 2; // 16 bytes
  bytes app_s_key       = 3; // 16 bytes
  bytes f_nwk_s_int_key = 4; // 16 bytes
  bytes s_nwk_s_int_key = 5; // 16 bytes
}

message RadioConfig {
  bool        enabled                   = 1;
  RadioRegion region                    = 2;
  RadioAuth   auth                      = 3;

  oneof credentials {
    RadioOTAA otaa = 4;
    RadioABP  abp  = 5;
  }

  uint32 transmit_interval_min          = 6;
  bool   tx_only_on_new_gps_fix         = 7;
  int32  tx_power_dbm                   = 8;
}

message MicrophoneConfig {
  bool            enabled            = 1;
  bool            continuous_mode    = 2; // on if true
  uint32          sample_length_min  = 3;
  uint32          sample_window_min  = 4;
}

enum AccelSampleRate {
  ACCEL_25HZ = 0;
  ACCEL_50HZ = 1;
}

enum AccelSensitivity {
  ACCEL_2G = 0;
  ACCEL_4G = 1;
  ACCEL_8G = 2;
}

message AccelerometerConfig {
  bool             enabled      = 1;
  AccelSampleRate  sample_rate  = 2;
  AccelSensitivity sensitivity  = 3;
}

message FirmwareInfo {
  string version = 1;
}

// schedule that is applied during each TimeWindow
message ScheduledConfig {
  TimeWindow         window        = 1;
  SamplingConfig     light         = 2;
  SamplingConfig     environmental = 3;
  SamplingConfig     particulate   = 4;
  GPSConfig          gps           = 5;
  RadioConfig        radio         = 6;
  MicrophoneConfig   microphone    = 7;
  AccelerometerConfig accelerometer = 8;

  FirmwareInfo       firmware      = 9;
}

// can include multiple schedules
message ScheduleConfigPacket {
  repeated ScheduledConfig schedules = 1;
}

// ================== WRAPPER ==================

message Packet {
    PacketHeader header = 1;
    ScheduleConfigPacket schedule_config_packet = 2;
}
